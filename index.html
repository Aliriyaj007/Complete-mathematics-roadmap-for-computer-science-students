<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS Math Roadmap | Interactive Guide</title>
    <style>
        /* --- CSS VARIABLES & THEMES --- */
        :root {
            /* Default Theme (Light) */
            --bg-body: #f4f6f8;
            --bg-card: #ffffff;
            --text-main: #2d3748;
            --text-muted: #718096;
            --primary: #3182ce;
            --primary-hover: #2b6cb0;
            --accent: #38b2ac;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
            --font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            --success: #48bb78;
            --info-bg: #ebf8ff;
            --info-text: #2c5282;
        }

        [data-theme="dark"] {
            --bg-body: #1a202c;
            --bg-card: #2d3748;
            --text-main: #f7fafc;
            --text-muted: #a0aec0;
            --primary: #63b3ed;
            --primary-hover: #4299e1;
            --accent: #4fd1c5;
            --border: #4a5568;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --info-bg: #2a4365;
            --info-text: #bee3f8;
        }

        [data-theme="cyber"] {
            --bg-body: #0d0221;
            --bg-card: #1a0b2e;
            --text-main: #e2e8f0;
            --text-muted: #a3bffa;
            --primary: #d53f8c; /* Pink/Purple */
            --primary-hover: #b83280;
            --accent: #00f3ff; /* Cyan */
            --border: #4c1d95;
            --shadow: 0 0 10px rgba(213, 63, 140, 0.2);
            --radius: 4px;
            --info-bg: #2d1b4e;
            --info-text: #e9d8fd;
        }

        /* --- GLOBAL RESET --- */
        * { box-sizing: border-box; margin: 0; padding: 0; transition: background-color 0.3s, color 0.3s; }
        body { font-family: var(--font-family); background-color: var(--bg-body); color: var(--text-main); line-height: 1.6; padding-bottom: 4rem; }

        /* --- HEADER & CONTROLS --- */
        header {
            background-color: var(--bg-card);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
            border-bottom: 1px solid var(--border);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .title-block h1 { font-size: 1.5rem; font-weight: 700; color: var(--primary); }
        .title-block p { font-size: 0.9rem; color: var(--text-muted); }

        .progress-container {
            flex-grow: 1;
            max-width: 400px;
            margin: 0 1rem;
        }
        .progress-labels { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.3rem; color: var(--text-muted); }
        .progress-bar-bg {
            height: 10px;
            background-color: var(--border);
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background-color: var(--success);
            width: 0%;
            transition: width 0.5s ease;
        }

        .controls { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        
        button {
            background-color: var(--bg-body);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        button:hover { background-color: var(--border); }
        button.primary-btn { background-color: var(--primary); color: white; border: none; }
        button.primary-btn:hover { background-color: var(--primary-hover); }

        /* --- MAIN GRID --- */
        main {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        /* --- CARD STYLES --- */
        .card {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        /* Info Card (for strategy/mindset) vs Phase Card */
        .card.info-panel { grid-column: 1 / -1; border-left: 5px solid var(--accent); }
        
        .card-header {
            padding: 1.2rem;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(to right, rgba(0,0,0,0.02), transparent);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .phase-tag {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent);
            font-weight: 800;
            margin-bottom: 0.25rem;
            display: block;
        }

        .card-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.25rem; }
        .card-duration { font-size: 0.85rem; color: var(--text-muted); display: flex; align-items: center; gap: 0.4rem; }
        
        .completion-badge {
            font-size: 0.75rem;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            background-color: var(--info-bg);
            color: var(--info-text);
            font-weight: bold;
        }
        .completion-badge.done { background-color: var(--success); color: white; }

        .card-body { padding: 1.2rem; flex-grow: 1; overflow-y: auto; max-height: 500px; }
        
        /* Section inside card */
        .topic-section { margin-bottom: 1.2rem; }
        .section-title { font-size: 0.9rem; font-weight: 700; color: var(--text-main); margin-bottom: 0.6rem; text-transform: uppercase; letter-spacing: 0.5px; }
        
        /* List Items */
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-main);
            cursor: pointer;
        }
        .checklist-item:hover input { transform: scale(1.1); }
        
        .checklist-item input[type="checkbox"] {
            appearance: none;
            min-width: 16px;
            height: 16px;
            border: 2px solid var(--text-muted);
            border-radius: 4px;
            margin-top: 3px;
            cursor: pointer;
            position: relative;
        }
        .checklist-item input[type="checkbox"]:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        .checklist-item input[type="checkbox"]:checked::after {
            content: '‚úì';
            color: white;
            position: absolute;
            font-size: 10px;
            top: -1px;
            left: 2px;
        }
        .checklist-item.checked span { text-decoration: line-through; color: var(--text-muted); }

        /* CS Connections Box */
        .cs-connection {
            background-color: var(--info-bg);
            color: var(--info-text);
            padding: 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            border-left: 3px solid var(--primary);
        }
        .cs-connection strong { display: block; margin-bottom: 0.3rem; color: inherit; }

        /* Lists without checkboxes (Resources/Mindset) */
        .plain-list li { margin-left: 1.2rem; margin-bottom: 0.3rem; font-size: 0.9rem; color: var(--text-main); }
        
        /* --- TOAST NOTIFICATIONS --- */
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .toast {
            background-color: var(--bg-card);
            border-left: 5px solid var(--success);
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            min-width: 250px;
            animation: slideIn 0.3s ease-out;
            color: var(--text-main);
            display: flex; 
            align-items: center; 
            justify-content: space-between;
        }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- FOOTER --- */
        footer {
            margin-top: 3rem;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border);
            padding-top: 2rem;
        }
        footer a { color: var(--primary); text-decoration: none; font-weight: 600; }
        footer a:hover { text-decoration: underline; }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        
        /* Mobile Adjustments */
        @media (max-width: 600px) {
            main { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; align-items: stretch; }
            .progress-container { max-width: 100%; margin: 1rem 0; }
            .controls { justify-content: space-between; }
        }
    </style>
</head>
<body data-theme="light">

    <header>
        <div class="header-content">
            <div class="title-block">
                <h1>CS Math Roadmap</h1>
                <p>Comprehensive Mathematics for Computer Science</p>
            </div>
            
            <div class="progress-container">
                <div class="progress-labels">
                    <span>Overall Progress</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="global-progress"></div>
                </div>
            </div>

            <div class="controls">
                <select id="theme-selector" onchange="changeTheme(this.value)">
                    <option value="light">‚òÄÔ∏è Light</option>
                    <option value="dark">üåô Dark</option>
                    <option value="cyber">ü§ñ Cyber</option>
                </select>
                <button onclick="backupData()">‚¨áÔ∏è Backup</button>
                <button onclick="document.getElementById('restore-file').click()">‚¨ÜÔ∏è Restore</button>
                <input type="file" id="restore-file" class="hidden" accept=".json" onchange="restoreData(this)">
                <button class="primary-btn" onclick="resetProgress()">Reset</button>
            </div>
        </div>
    </header>

    <main id="roadmap-container">
        <!-- Content injected via JS -->
    </main>

    <footer>
        <p>Made with ‚ù§Ô∏è by <a href="https://github.com/Aliriyaj007" target="_blank">Aliriyaj007</a></p>
    </footer>

    <div id="toast-container"></div>

    <script>
        // --- DATASETS ---
        // Modular data structure for scalability
        const roadmapData = [
            {
                type: "phase",
                phase: "Phase 0",
                title: "Foundation Building",
                duration: "1-3 months",
                topics: {
                    "Basic Arithmetic & Pre-Algebra": [
                        "Number systems (integers, fractions, decimals)",
                        "Order of operations (PEMDAS/BODMAS)",
                        "Factors, multiples, primes",
                        "Ratios, proportions, percentages",
                        "Basic equations and inequalities"
                    ],
                    "Elementary Algebra": [
                        "Linear equations and graphing",
                        "Polynomials (addition, multiplication, factoring)",
                        "Quadratic equations",
                        "Systems of equations",
                        "Functions and their properties"
                    ]
                },
                connections: [
                    "Understanding data representation",
                    "Basic algorithm counting steps",
                    "Simple complexity reasoning"
                ]
            },
            {
                type: "phase",
                phase: "Phase 1",
                title: "Core Discrete Mathematics",
                duration: "3-6 months",
                topics: {
                    "Logic & Proofs": [
                        "Propositional and predicate logic",
                        "Truth tables, logical equivalences",
                        "Proof techniques: direct, contradiction, induction",
                        "Quantifiers and negations"
                    ],
                    "Set Theory": [
                        "Sets, subsets, power sets",
                        "Set operations (union, intersection, complement)",
                        "Relations and equivalence relations",
                        "Functions: injective, surjective, bijective",
                        "Cardinality and countability"
                    ],
                    "Combinatorics": [
                        "Counting principles: addition, multiplication",
                        "Permutations and combinations",
                        "Binomial theorem and coefficients",
                        "Pigeonhole principle",
                        "Inclusion-exclusion principle"
                    ],
                    "Graph Theory Basics": [
                        "Graphs, vertices, edges, degree",
                        "Paths, cycles, connectivity",
                        "Trees and spanning trees",
                        "Graph representations (adjacency matrix/list)"
                    ]
                },
                connections: [
                    "Database query logic",
                    "Algorithm correctness proofs",
                    "Data structure design (trees, graphs)",
                    "Network modeling"
                ]
            },
            {
                type: "phase",
                phase: "Phase 2",
                title: "Calculus & Continuous Mathematics",
                duration: "4-8 months",
                topics: {
                    "Single-Variable Calculus": [
                        "Limits and continuity",
                        "Derivatives: rules, applications, optimization",
                        "Integrals: definite/indefinite, techniques",
                        "Fundamental Theorem of Calculus",
                        "Series and sequences (convergence tests)"
                    ],
                    "Multivariable Calculus": [
                        "Partial derivatives and gradients",
                        "Multiple integrals",
                        "Vector calculus basics",
                        "Optimization with constraints"
                    ],
                    "Differential Equations Basics": [
                        "First-order linear equations",
                        "Applications to modeling"
                    ]
                },
                connections: [
                    "Machine learning optimization (gradient descent)",
                    "Computer graphics (curves, surfaces)",
                    "Physics simulations",
                    "Algorithm analysis (summations, integrals)"
                ]
            },
            {
                type: "phase",
                phase: "Phase 3",
                title: "Linear Algebra",
                duration: "3-5 months",
                topics: {
                    "Foundations": [
                        "Vectors and vector spaces",
                        "Linear transformations",
                        "Matrices and matrix operations",
                        "Systems of linear equations (Gaussian elimination)"
                    ],
                    "Core Concepts": [
                        "Determinants and properties",
                        "Eigenvalues and eigenvectors",
                        "Diagonalization",
                        "Orthogonality and projections",
                        "Vector norms and inner products"
                    ],
                    "Advanced Topics": [
                        "Singular Value Decomposition (SVD)",
                        "Principal Component Analysis (PCA)",
                        "Linear programming basics"
                    ]
                },
                connections: [
                    "Computer graphics (transformations)",
                    "Machine learning (dimensionality reduction)",
                    "Network analysis (adjacency matrices)",
                    "Cryptography (linear cryptanalysis)"
                ]
            },
            {
                type: "phase",
                phase: "Phase 4",
                title: "Probability & Statistics",
                duration: "3-6 months",
                topics: {
                    "Probability Theory": [
                        "Axioms of probability",
                        "Conditional probability and Bayes' theorem",
                        "Random variables: discrete and continuous",
                        "Expectation, variance, moments",
                        "Common distributions (Bernoulli, Binomial, Gaussian, Exponential)"
                    ],
                    "Statistics": [
                        "Descriptive statistics",
                        "Statistical inference",
                        "Hypothesis testing",
                        "Confidence intervals",
                        "Regression analysis"
                    ],
                    "Applied Probability": [
                        "Markov chains",
                        "Random processes basics",
                        "Information theory (entropy, KL divergence)"
                    ]
                },
                connections: [
                    "Machine learning (Bayesian methods)",
                    "Randomized algorithms",
                    "Data science and analytics",
                    "Network reliability modeling",
                    "Cryptography (random number generation)"
                ]
            },
            {
                type: "phase",
                phase: "Phase 5",
                title: "Advanced Discrete Structures",
                duration: "4-6 months",
                topics: {
                    "Advanced Graph Theory": [
                        "Graph algorithms (shortest path, max flow)",
                        "Planarity and coloring",
                        "Matching theory",
                        "Network flows"
                    ],
                    "Abstract Algebra Basics": [
                        "Groups, rings, fields",
                        "Modular arithmetic",
                        "Finite fields (Galois fields)"
                    ],
                    "Number Theory for CS": [
                        "Modular arithmetic",
                        "Prime numbers and factorization",
                        "Chinese Remainder Theorem",
                        "Euler's theorem and Fermat's little theorem"
                    ],
                    "Formal Languages & Automata": [
                        "Regular languages and finite automata",
                        "Context-free grammars and pushdown automata",
                        "Turing machines",
                        "Computability and complexity basics"
                    ]
                },
                connections: [
                    "Algorithm design (greedy, dynamic programming)",
                    "Cryptography (RSA, elliptic curves)",
                    "Compiler design (parsing)",
                    "Database theory (relational algebra)"
                ]
            },
            {
                type: "phase",
                phase: "Phase 6",
                title: "Advanced Math for Specializations",
                duration: "Ongoing",
                topics: {
                    "For Machine Learning/AI": [
                        "Multivariate calculus (matrix calculus)",
                        "Information geometry",
                        "Optimization theory",
                        "Statistical learning theory",
                        "Stochastic processes"
                    ],
                    "For Computer Graphics/Games": [
                        "Computational geometry",
                        "Differential geometry basics",
                        "Quaternions and rotations",
                        "Fourier analysis",
                        "Numerical methods"
                    ],
                    "For Cryptography/Security": [
                        "Advanced number theory",
                        "Elliptic curve cryptography",
                        "Lattice-based cryptography",
                        "Complexity theory (P vs NP)",
                        "Information theory"
                    ],
                    "For Theory/Research": [
                        "Real analysis",
                        "Measure theory basics",
                        "Category theory introduction",
                        "Advanced combinatorics (generating functions)",
                        "Topology basics"
                    ],
                    "For Data Science": [
                        "Bayesian statistics",
                        "Time series analysis",
                        "Multivariate statistics",
                        "Experimental design",
                        "Non-parametric methods"
                    ]
                },
                connections: ["Specialization-specific application", "Cutting-edge research implementation"]
            },
            {
                type: "phase",
                phase: "Phase 7",
                title: "Numerical Methods & Computational Math",
                duration: "3-4 months",
                topics: {
                    "Numerical Analysis": [
                        "Floating point arithmetic",
                        "Numerical linear algebra",
                        "Root finding algorithms",
                        "Numerical integration and differentiation",
                        "Interpolation and approximation"
                    ],
                    "Optimization": [
                        "Linear programming (simplex method)",
                        "Convex optimization basics",
                        "Gradient methods",
                        "Constrained optimization"
                    ]
                },
                connections: ["Scientific computing", "Simulations", "High-performance algorithm tuning"]
            },
            {
                type: "info",
                title: "Learning Strategy & Resources",
                content: {
                    "Progressive Project Integration": [
                        "Beginner: Implement basic algorithms (factorial, Fibonacci with proofs)",
                        "Intermediate: Build a simple neural network (calculus + linear algebra)",
                        "Advanced: Implement RSA encryption (number theory)",
                        "Expert: Create a simple ray tracer (linear algebra + calculus)"
                    ],
                    "Recommended Resources": [
                        "Books: 'Concrete Mathematics' by Knuth, 'Linear Algebra Done Right'",
                        "Online: MIT OCW, 3Blue1Brown (YouTube), Khan Academy",
                        "Interactive: Project Euler, LeetCode math problems",
                        "Software: Python with NumPy/SciPy, MATLAB, Wolfram Mathematica"
                    ]
                }
            },
            {
                type: "info",
                title: "Assessment & Timeline",
                content: {
                    "Assessment Milestones": [
                        "Can prove algorithm correctness using induction",
                        "Can derive backpropagation from calculus principles",
                        "Can implement SVD from scratch",
                        "Can analyze randomized algorithm success probability",
                        "Can design a cryptosystem using number theory"
                    ],
                    "Timeline Suggestions": [
                        "Year 1: Phases 0-2 (Foundation + Discrete Math + Calculus)",
                        "Year 2: Phases 3-4 (Linear Algebra + Probability)",
                        "Year 3: Phase 5 (Advanced Discrete)",
                        "Year 4+: Phase 6 (Specializations)"
                    ],
                    "Key Mindset Principles": [
                        "Mathematics is a language for expressing computational ideas",
                        "Focus on intuition before formalism",
                        "Implement to internalize - always code the concepts",
                        "Connect every concept to a CS application",
                        "Embrace abstraction - it's the essence of computer science"
                    ]
                }
            }
        ];

        // --- STATE MANAGEMENT ---
        let appState = {
            theme: 'light',
            completed: {} // Key format: "phaseIndex-sectionIndex-itemIndex"
        };

        // --- DOM ELEMENTS ---
        const container = document.getElementById('roadmap-container');
        const progressBar = document.getElementById('global-progress');
        const progressText = document.getElementById('progress-text');

        // --- INITIALIZATION ---
        function init() {
            loadState();
            renderRoadmap();
            applyTheme(appState.theme);
            updateProgress();
        }

        // --- RENDERING LOGIC ---
        function renderRoadmap() {
            container.innerHTML = '';

            roadmapData.forEach((item, index) => {
                const card = document.createElement('article');
                card.className = `card ${item.type === 'info' ? 'info-panel' : ''}`;
                
                if (item.type === 'phase') {
                    renderPhaseCard(card, item, index);
                } else {
                    renderInfoCard(card, item);
                }
                
                container.appendChild(card);
            });
        }

        function renderPhaseCard(card, data, phaseIndex) {
            // Calculating completion for this phase
            let totalItems = 0;
            let checkedItems = 0;

            // Generate HTML for sections
            let sectionsHtml = '';
            let sectionIndex = 0;
            
            for (const [sectionTitle, items] of Object.entries(data.topics)) {
                let itemsHtml = '';
                items.forEach((topic, itemIndex) => {
                    const uniqueId = `${phaseIndex}-${sectionIndex}-${itemIndex}`;
                    const isChecked = appState.completed[uniqueId] ? 'checked' : '';
                    if (isChecked) checkedItems++;
                    totalItems++;

                    itemsHtml += `
                        <label class="checklist-item ${isChecked}">
                            <input type="checkbox" ${isChecked} onchange="toggleItem('${uniqueId}')">
                            <span>${topic}</span>
                        </label>
                    `;
                });
                sectionIndex++;

                sectionsHtml += `
                    <div class="topic-section">
                        <div class="section-title">${sectionTitle}</div>
                        ${itemsHtml}
                    </div>
                `;
            }

            // Percentage for this phase badge
            const percent = totalItems === 0 ? 0 : Math.round((checkedItems / totalItems) * 100);
            const badgeClass = percent === 100 ? 'completion-badge done' : 'completion-badge';

            // Connections
            const connectionsHtml = data.connections.map(c => `<li>${c}</li>`).join('');

            card.innerHTML = `
                <div class="card-header">
                    <div>
                        <span class="phase-tag">${data.phase}</span>
                        <div class="card-title">${data.title}</div>
                        <div class="card-duration">‚è± ${data.duration}</div>
                    </div>
                    <div class="${badgeClass}">${percent}%</div>
                </div>
                <div class="card-body">
                    ${sectionsHtml}
                    <div class="cs-connection">
                        <strong>üîó Practical CS Connection</strong>
                        <ul class="plain-list" style="margin-left: 1rem; margin-bottom:0;">
                            ${connectionsHtml}
                        </ul>
                    </div>
                </div>
            `;
        }

        function renderInfoCard(card, data) {
            let sectionsHtml = '';
            for (const [title, items] of Object.entries(data.content)) {
                const listItems = items.map(item => `<li>${item}</li>`).join('');
                sectionsHtml += `
                    <div class="topic-section">
                        <div class="section-title" style="color: var(--primary);">${title}</div>
                        <ul class="plain-list">${listItems}</ul>
                    </div>
                `;
            }

            card.innerHTML = `
                <div class="card-header">
                    <div class="card-title" style="font-size: 1.3rem;">${data.title}</div>
                </div>
                <div class="card-body">
                    ${sectionsHtml}
                </div>
            `;
        }

        // --- INTERACTIVITY ---
        function toggleItem(id) {
            if (appState.completed[id]) {
                delete appState.completed[id];
            } else {
                appState.completed[id] = true;
            }
            saveState();
            updateProgress();
            // Re-render to update the percentage badges and visuals
            renderRoadmap(); 
        }

        function updateProgress() {
            // Calculate total progress
            // Note: Info panels don't have checkboxes, so we iterate through 'phase' types only
            let total = 0;
            let done = 0;

            roadmapData.forEach((item, pIdx) => {
                if (item.type === 'phase') {
                    let sIdx = 0;
                    for (const [_, items] of Object.entries(item.topics)) {
                        items.forEach((_, iIdx) => {
                            total++;
                            if (appState.completed[`${pIdx}-${sIdx}-${iIdx}`]) done++;
                        });
                        sIdx++;
                    }
                }
            });

            const percent = total === 0 ? 0 : Math.round((done / total) * 100);
            progressBar.style.width = `${percent}%`;
            progressText.textContent = `${percent}% Complete`;
        }

        function changeTheme(themeName) {
            appState.theme = themeName;
            applyTheme(themeName);
            saveState();
        }

        function applyTheme(themeName) {
            document.body.setAttribute('data-theme', themeName);
            document.getElementById('theme-selector').value = themeName;
        }

        function resetProgress() {
            if(confirm("Are you sure you want to reset all progress? This cannot be undone.")) {
                appState.completed = {};
                saveState();
                init(); // Reload everything
                showToast("Progress reset successfully.");
            }
        }

        // --- STORAGE & BACKUP ---
        function saveState() {
            localStorage.setItem('csMathRoadmap', JSON.stringify(appState));
        }

        function loadState() {
            const saved = localStorage.getItem('csMathRoadmap');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    // Merge to ensure new fields in future updates don't break older saves
                    appState = { ...appState, ...parsed, completed: parsed.completed || {} };
                } catch (e) {
                    console.error("Save file corrupted, starting fresh.");
                }
            }
        }

        function backupData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appState));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            const date = new Date().toISOString().slice(0,10);
            downloadAnchorNode.setAttribute("download", `cs_math_roadmap_backup_${date}.json`);
            document.body.appendChild(downloadAnchorNode); // required for firefox
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            showToast("Backup downloaded successfully!");
        }

        function restoreData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = JSON.parse(e.target.result);
                    if (content.completed && content.theme) {
                        appState = content;
                        saveState();
                        init();
                        showToast("Data restored successfully!");
                    } else {
                        showToast("Invalid backup file format.");
                    }
                } catch (err) {
                    showToast("Error reading file.");
                }
            };
            reader.readAsText(file);
            // Reset input so same file can be selected again if needed
            input.value = '';
        }

        // --- UTILS ---
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<span>${message}</span>`;
            
            const container = document.getElementById('toast-container');
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Start App
        init();

    </script>
</body>
</html>
